<!-- Modern All Lessons Page - Sidebar Style -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/lessons-modern.css') }}">

<style>
/* Ripple animation for color picker */
@keyframes ripple {
    0% {
        transform: scale(0);
        opacity: 1;
    }
    100% {
        transform: scale(2);
        opacity: 0;
    }
}
</style>

<div class="lessons-page">
    <!-- Hero Header -->
    <div class="lessons-hero">
        <div class="lessons-hero-content">
            <h1 class="lessons-hero-title">All Classes</h1>
            <p class="lessons-hero-subtitle">Organize, track, and master your learning journey</p>
            
            <div class="lessons-hero-actions">
                <div class="lessons-search-wrapper">
                    <div class="lessons-search-hero">
                        <i class="bi bi-search lessons-search-hero-icon"></i>
                        <input type="text" id="lessonSearch" placeholder="Search classes...">
                    </div>
                    
                    <!-- Compact Filter Pills -->
                    <div class="lessons-filter-compact">
                        <button class="filter-compact-btn active" data-filter="all" onclick="filterLessons('all', this)">
                            <i class="bi bi-grid-fill"></i>
                            <span>All</span>
                        </button>
                        <button class="filter-compact-btn" data-filter="favorites" onclick="filterLessons('favorites', this)">
                            <i class="bi bi-star-fill"></i>
                            <span>Favorites</span>
                        </button>
                        <button class="filter-compact-btn" data-filter="active" onclick="filterLessons('active', this)">
                            <i class="bi bi-play-circle-fill"></i>
                            <span>Active</span>
                        </button>
                        <button class="filter-compact-btn" data-filter="completed" onclick="filterLessons('completed', this)">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Completed</span>
                        </button>
                    </div>
                </div>
                
                <button class="lessons-btn lessons-btn-primary" data-bs-toggle="modal" data-bs-target="#addLessonModal">
                    <i class="bi bi-plus-circle-fill"></i>
                    <span>Create Class</span>
                </button>
                
                <button class="lessons-btn lessons-btn-outline" onclick="window.location.reload()">
                    <i class="bi bi-arrow-clockwise"></i>
                    <span>Refresh</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="lessons-content">

        <!-- Lessons Grid -->
        <div class="lessons-grid" id="lessons-grid">
            {% if lessons %}
                {% for lesson in lessons %}
                    <div class="lesson-card-modern" 
                         data-lesson-id="{{ lesson.id }}" 
                         data-status="{{ lesson.status or 'active' }}" 
                         data-is-favorite="{{ 'true' if lesson.is_favorite else 'false' }}"
                         onclick="navigateToClass('{{ lesson.id }}', event)"
                         style="cursor: pointer;">
                        
                        <!-- Card Cover -->
                        <div class="lesson-card-cover">
                            {% if lesson.cover_image %}
                                <img src="{{ url_for('static', filename=lesson.cover_image) }}" 
                                     alt="{{ lesson.title }}">
                            {% else %}
                                {% set color_gradients = {
                                    1: 'linear-gradient(135deg, #1976D2, #0D47A1)',
                                    2: 'linear-gradient(135deg, #48BB78, #38A169)',
                                    3: 'linear-gradient(135deg, #FC8181, #F56565)',
                                    4: 'linear-gradient(135deg, #F6AD55, #ED8936)',
                                    5: 'linear-gradient(135deg, #9F7AEA, #805AD5)',
                                    6: 'linear-gradient(135deg, #F687B3, #ED64A6)'
                                } %}
                                {% set color_id = lesson.color_theme or lesson.selected_color or 1 %}
                                {% set gradient = color_gradients[color_id|int] or color_gradients[1] %}
                                <div class="lesson-card-gradient-cover" style="background: {{ gradient }};">
                                    <i class="bi bi-book-fill"></i>
                                </div>
                            {% endif %}
                            
                            <!-- Badges -->
                            <div class="lesson-card-badges">
                                <div class="lesson-card-status-badge {{ lesson.status or 'active' }}">
                                    {% if lesson.status == 'completed' %}
                                        Completed
                                    {% elif lesson.status == 'archived' %}
                                        Archived
                                    {% else %}
                                        Active
                                    {% endif %}
                                </div>
                                
                                <div class="lesson-card-favorite {{ 'active' if lesson.is_favorite else '' }}" 
                                     onclick="event.stopPropagation(); toggleFavorite('{{ lesson.id }}', this);">
                                    <i class="bi {{ 'bi-star-fill' if lesson.is_favorite else 'bi-star' }}"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Card Body -->
                        <div class="lesson-card-body">
                            <h3 class="lesson-card-title">{{ lesson.title }}</h3>
                            
                            {% if lesson.description %}
                                <p class="lesson-card-description">{{ lesson.description }}</p>
                            {% else %}
                                <p class="lesson-card-description">No description available</p>
                            {% endif %}
                            
                            <!-- Card Footer -->
                            <div class="lesson-card-footer">
                                <div class="lesson-card-meta">
                                    <i class="bi bi-calendar3"></i>
                                    <span>{{ lesson.created_at.strftime('%b %d, %Y') if lesson.created_at else 'N/A' }}</span>
                                </div>
                                <div class="lesson-card-arrow">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <!-- Empty State -->
                <div class="lessons-empty">
                    <div class="lessons-empty-icon">
                        <i class="bi bi-journal-plus"></i>
                    </div>
                    <h3>No Classes Yet</h3>
                    <p>Start your learning journey by creating your first class</p>
                    <button class="lessons-btn lessons-btn-primary" data-bs-toggle="modal" data-bs-target="#addLessonModal">
                        <i class="bi bi-plus-circle-fill"></i>
                        <span>Create Your First Class</span>
                    </button>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Modern Lessons Page Initialization
// Note: All functions are defined in main.js for global access
(function() {
    'use strict';
    
    console.log('ðŸŽ“ Initializing All Classes page...');
    
    // Set initial filter state
    window.currentLessonFilter = 'all';
    
    // Setup search functionality
    const searchInput = document.getElementById('lessonSearch');
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const lessonCards = document.querySelectorAll('.lesson-card-modern');
            
            lessonCards.forEach(card => {
                const title = card.querySelector('.lesson-card-title')?.textContent.toLowerCase() || '';
                const description = card.querySelector('.lesson-card-description')?.textContent.toLowerCase() || '';
                const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
                const matchesFilter = window.checkFilterMatch(card, window.currentLessonFilter);
                
                card.style.display = (matchesSearch && matchesFilter) ? '' : 'none';
            });
        });
        console.log('  âœ“ Search initialized');
    }
    
    // Log all cards for debugging
    const allCards = document.querySelectorAll('.lesson-card-modern');
    console.log(`  âœ“ Total cards loaded: ${allCards.length}`);
    
    if (allCards.length > 0) {
        allCards.forEach((card, index) => {
            console.log(`    Card ${index + 1}:`, {
                id: card.dataset.lessonId,
                status: card.dataset.status,
                isFavorite: card.dataset.isFavorite,
                title: card.querySelector('.lesson-card-title')?.textContent
            });
        });
        
        // Initial sort by favorites
        setTimeout(() => {
            if (typeof window.sortLessonsByFavorite === 'function') {
                window.sortLessonsByFavorite();
                console.log('  âœ“ Initial favorite sorting applied');
            }
        }, 100);
    }
    
    console.log('âœ… All Classes page initialized');
})();
</script>

<!-- Add Lesson Modal -->
{% include 'modals/add_lesson_modal.html' %}

