<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Smart Learning Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
    <div class="auth-page">
        <div class="auth-container">
            <aside class="auth-sidebar" aria-hidden="false">
                <div class="auth-sidebar__brand">
                    <div class="auth-sidebar__icon"><i class="fas fa-graduation-cap"></i></div>
                    <h3>Smart Learning Hub</h3>
                    <p class="muted">Join thousands of learners — track progress, organize notes, and connect with Google Classroom & Teams.</p>
                </div>

                <ul class="auth-features list-unstyled mt-4">
                    <li><i class="fas fa-check-circle me-2"></i>Free account setup</li>
                    <li><i class="fas fa-check-circle me-2"></i>Sync with Google & Teams</li>
                    <li><i class="fas fa-check-circle me-2"></i>Track your learning journey</li>
                </ul>

                <div class="auth-sidebar__footer mt-4">
                    <small>© {{ current_year or 2025 }} Smart Learning Hub</small>
                </div>
            </aside>

            <main class="auth-main">
                <div class="register-container">
                    <div class="register-header">
                        <h2><i class="fas fa-user-plus me-2"></i>Create Account</h2>
                        <p class="mb-0 fw-light">Join us and start your learning journey!</p>
                    </div>
                    <div class="register-form">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                        {{ message }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}
                        
                        <form method="POST" action="{{ url_for('web_auth.register') }}">
                            <div class="form-floating mb-3 input-group-icon">
                                <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com" required>
                                <label for="email">Email Address</label>
                                <span class="input-icon"><i class="fas fa-envelope"></i></span>
                            </div>

                            <div class="form-floating mb-3 input-group-icon">
                                <input type="password" class="form-control" id="password" name="password" placeholder="Password" required>
                                <label for="password">Password</label>
                                <span class="input-icon"><i class="fas fa-lock"></i></span>
                            </div>

                            <div class="form-floating mb-4 input-group-icon">
                                <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirm Password" required>
                                <label for="confirm_password">Confirm Password</label>
                                <span class="input-icon"><i class="fas fa-check-circle"></i></span>
                            </div>
                            
                            <div class="d-grid mb-3">
                                <button type="submit" class="btn btn-primary btn-register">
                                    <i class="fas fa-user-plus me-2"></i>Create Account
                                </button>
                            </div>
                        </form>
                        
                        <div class="divider-text">
                            <span>OR</span>
                        </div>

                        <div class="d-grid">
                            <a href="{{ url_for('google_auth.login') }}" class="btn btn-google btn-google--blue btn-google--full" id="google-signin-register" aria-label="Sign up with Google">
                                <i class="fab fa-google"></i>
                                <span class="label-small">สมัครด้วย Google</span>
                                <span class="spinner" aria-hidden="true"></span>
                            </a>
                        </div>
                        <div class="text-center mt-4 signin-link">
                            <p class="mb-0 text-muted">Already have an account? 
                                <a href="{{ url_for('web_auth.login') }}">
                                    Sign in here
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Password confirmation validation
        const passwordField = document.getElementById('password');
        const confirmPasswordField = document.getElementById('confirm_password');
        const submitButton = document.querySelector('.btn-register');
        
        function validatePasswords() {
            const password = passwordField.value;
            const confirmPassword = confirmPasswordField.value;
            
            // Remove existing validation classes
            confirmPasswordField.classList.remove('is-valid', 'is-invalid');
            
            if (confirmPassword.length === 0) {
                return;
            }
            
            if (password === confirmPassword) {
                confirmPasswordField.classList.add('is-valid');
                confirmPasswordField.setCustomValidity('');
            } else {
                confirmPasswordField.classList.add('is-invalid');
                confirmPasswordField.setCustomValidity('Passwords do not match');
            }
        }
        
        // Real-time validation
        passwordField.addEventListener('input', validatePasswords);
        confirmPasswordField.addEventListener('input', validatePasswords);
        
        // Form submission validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const password = passwordField.value;
            const confirmPassword = confirmPasswordField.value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                confirmPasswordField.classList.add('is-invalid');
                confirmPasswordField.focus();
                
                // Show alert
                const existingAlert = document.querySelector('.password-mismatch-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger password-mismatch-alert mt-3';
                alertDiv.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>รหัสผ่านไม่ตรงกัน กรุณาตรวจสอบอีกครั้ง';
                confirmPasswordField.parentNode.appendChild(alertDiv);
                
                // Auto-remove alert after 5 seconds
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 5000);
            }
        });
        
        // Password strength indicator (optional)
        passwordField.addEventListener('input', function() {
            const password = this.value;
            const strengthText = document.getElementById('password-strength');
            
            if (!strengthText) {
                const strengthDiv = document.createElement('div');
                strengthDiv.id = 'password-strength';
                strengthDiv.className = 'password-strength mt-1';
                this.parentNode.appendChild(strengthDiv);
            }
            
            let strength = 0;
            let text = '';
            let className = '';
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            if (password.length === 0) {
                document.getElementById('password-strength').innerHTML = '';
                return;
            }
            
            switch (strength) {
                case 0:
                case 1:
                    text = 'รหัสผ่านอ่อน';
                    className = 'text-danger';
                    break;
                case 2:
                case 3:
                    text = 'รหัสผ่านปานกลาง';
                    className = 'text-warning';
                    break;
                case 4:
                case 5:
                    text = 'รหัสผ่านแข็งแรง';
                    className = 'text-success';
                    break;
            }
            
            document.getElementById('password-strength').innerHTML = 
                `<small class="${className}"><i class="fas fa-shield-alt me-1"></i>${text}</small>`;
        });
    </script>
</body>
</html>