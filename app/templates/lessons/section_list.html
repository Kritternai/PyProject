{% if sections %}
  <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for section in sections %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0" data-type="{{ section.type }}">
        <div class="card-body position-relative">
          <div class="d-flex align-items-center mb-2">
            {% if section.type == 'text' or not section.type %}
              <i class="bi bi-file-earmark-text text-primary fs-4 me-2"></i>
            {% elif section.type == 'file' %}
              <i class="bi bi-paperclip text-info fs-4 me-2"></i>
            {% elif section.type == 'assignment' %}
              <i class="bi bi-calendar-check text-success fs-4 me-2"></i>
            {% elif section.type == 'note' %}
              <i class="bi bi-journal-text text-warning fs-4 me-2"></i>
            {% endif %}
            <h5 class="card-title mb-0">{{ section.title }}</h5>
            <span class="badge bg-light text-dark ms-2">{{ section.type|capitalize }}</span>
            <div class="ms-auto d-flex gap-1">
              <button class="btn btn-sm btn-outline-warning" title="Edit" onclick="editSection('{{ lesson.id }}', '{{ section.id }}')"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="deleteSection('{{ lesson.id }}', '{{ section.id }}')"><i class="bi bi-trash"></i></button>
            </div>
          </div>
          <div class="mt-2">
            {% if section.type == 'text' or not section.type %}
              <div>{{ section.content }}</div>
            {% elif section.type == 'file' %}
              {% set file_urls = [] %}
              {% if section.file_urls %}
                {% set file_urls = (section.file_urls | safe | loads) %}
              {% endif %}
              {% for url in file_urls %}
                {% set ext = url.split('.')[-1]|lower %}
                <div class="mb-2">
                  {% if ext in ['jpg', 'jpeg', 'png', 'gif', 'webp'] %}
                    <img src="{{ url }}" class="img-fluid rounded border mb-2" style="max-height:180px;object-fit:contain;">
                    <div><a href="{{ url }}" target="_blank" class="btn btn-outline-info btn-sm"><i class="bi bi-download"></i> Download Image</a></div>
                  {% elif ext == 'pdf' %}
                    <embed src="{{ url }}" type="application/pdf" width="100%" height="200px" class="mb-2"/>
                    <div><a href="{{ url }}" target="_blank" class="btn btn-outline-info btn-sm"><i class="bi bi-download"></i> Download PDF</a></div>
                  {% else %}
                    <div class="mb-2"><i class="bi bi-file-earmark text-secondary fs-3"></i></div>
                    <div><a href="{{ url }}" target="_blank" class="btn btn-outline-info btn-sm"><i class="bi bi-download"></i> Download File</a></div>
                  {% endif %}
                </div>
              {% endfor %}
            {% elif section.type == 'assignment' %}
              <div>{{ section.content }}</div>
              {% if section.assignment_due %}<div class="text-danger small mt-1"><i class="bi bi-clock"></i> Due: {{ section.assignment_due.strftime('%Y-%m-%d %H:%M') }}</div>{% endif %}
            {% elif section.type == 'note' %}
              <div class="text-muted fst-italic">{{ section.content }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-muted">No content yet. Click + Add Content to start.</div>
{% endif %}
<!-- JS SPA logic for Edit/Delete will be in main.js --> 