<h2 class="h5 mb-3">Edit Content</h2>
<form id="edit-section-form" enctype="multipart/form-data">
  <div class="row g-3">
    <div class="col-md-4">
      <label for="type" class="form-label">Type</label>
      <select id="type" name="type" class="form-select" required onchange="toggleSectionFields()">
        <option value="text" {% if section.type == 'text' %}selected{% endif %}>ğŸ“ Text</option>
        <option value="file" {% if section.type == 'file' %}selected{% endif %}>ğŸ“ File</option>
        <option value="assignment" {% if section.type == 'assignment' %}selected{% endif %}>ğŸ“… Assignment</option>
        <option value="note" {% if section.type == 'note' %}selected{% endif %}>ğŸ—’ï¸ Note</option>
      </select>
      <div class="form-text">Choose the type of content to add.</div>
    </div>
    <div class="col-md-8">
      <label for="title" class="form-label">Title</label>
      <input type="text" id="title" name="title" value="{{ section.title }}" required class="form-control" maxlength="100" placeholder="Enter content title">
    </div>
  </div>
  <div class="row g-3 mt-1">
    <div class="col-12" id="content-group">
      <label for="content" class="form-label">Content</label>
      <textarea id="content" name="content" class="form-control" rows="3" placeholder="Enter content or instructions">{{ section.content or '' }}</textarea>
    </div>
    <div class="col-12 d-none" id="file-group">
      <label for="file" class="form-label">File</label>
      {% if section.file_urls %}
        {% set file_urls = (section.file_urls | safe | loads) %}
        {% for url in file_urls %}
          <div class="mb-2"><a href="{{ url }}" target="_blank">Current File</a></div>
        {% endfor %}
      {% endif %}
      <input type="file" id="file" name="file" class="form-control">
      <div class="form-text">Upload a file (PDF, DOCX, etc.)</div>
    </div>
    <div class="col-12 d-none" id="due-group">
      <label for="assignment_due" class="form-label">Due Date</label>
      <input type="datetime-local" id="assignment_due" name="assignment_due" class="form-control" value="{% if section.assignment_due %}{{ section.assignment_due.strftime('%Y-%m-%dT%H:%M') }}{% endif %}">
      <div class="form-text">Set a due date for assignments (optional)</div>
    </div>
  </div>
  <div class="d-flex justify-content-end mt-4">
    <button type="submit" class="btn btn-primary"><i class="bi bi-save"></i> Update</button>
  </div>
</form>
<script>
function toggleSectionFields() {
  const type = document.getElementById('type').value;
  // Show/hide fields
  document.getElementById('content-group').classList.toggle('d-none', type === 'file');
  document.getElementById('file-group').classList.toggle('d-none', type !== 'file');
  document.getElementById('due-group').classList.toggle('d-none', type !== 'assignment');
  // Set required attributes
  document.getElementById('content').required = (type !== 'file');
  document.getElementById('file').required = (type === 'file');
  document.getElementById('assignment_due').required = (type === 'assignment');
}
document.getElementById('type').addEventListener('change', toggleSectionFields);
toggleSectionFields();
const editSectionForm = document.getElementById('edit-section-form');
if (editSectionForm) {
  editSectionForm.onsubmit = function(e) {
    // Validate before submit
    const type = document.getElementById('type').value;
    if (type !== 'file' && !document.getElementById('content').value.trim()) {
      alert('Please enter content.');
      document.getElementById('content').focus();
      e.preventDefault();
      return;
    }
    if (type === 'file' && !document.getElementById('file').files.length) {
      alert('Please select a file.');
      document.getElementById('file').focus();
      e.preventDefault();
      return;
    }
    if (type === 'assignment' && !document.getElementById('assignment_due').value) {
      alert('Please select a due date.');
      document.getElementById('assignment_due').focus();
      e.preventDefault();
      return;
    }
    e.preventDefault();
    const formData = new FormData(editSectionForm);
    fetch('', {
      method: 'POST',
      body: formData,
      headers: {
        'X-Requested-With': 'XMLHttpRequest',
        'Accept': 'application/json'
      }
    })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        loadPage('class/{{ lesson.id }}');
      } else {
        alert(data.message || 'Error updating content.');
      }
    });
  };
}
</script> 