<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Smart Learning Hub{% endblock %}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/fontawesome-free-6.5.2-web/css/all.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/enchat-sidebar.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">
  {% block head %}{% endblock %}
</head>
<body>
<div class="d-flex">
  <nav class="enchat-sidebar">
    <div class="enchat-sidebar__header">
      <a href="#" class="enchat-sidebar__logo" onclick="loadPage('class');return false;">
        <span class="enchat-sidebar__logo-icon">
          <i class="bi bi-mortarboard-fill"></i>
        </span>
        <div class="enchat-sidebar__logo-text">
          Smart Learning
          <span class="enchat-sidebar__logo-subtitle">Hub</span>
        </div>
      </a>
    </div>

    <div class="enchat-sidebar__menu">
      <ul class="enchat-sidebar__nav">
        <li class="enchat-sidebar__nav-item">
          <a href="#" class="enchat-sidebar__nav-link" data-page="class" onclick="setActiveNav(this);loadPage('class');return false;">
            <i class="enchat-sidebar__nav-icon bi bi-book-fill"></i>
            <span class="enchat-sidebar__nav-text">Class</span>
          </a>
        </li>
        <li class="enchat-sidebar__nav-item">
          <a href="#" class="enchat-sidebar__nav-link" data-page="note" onclick="setActiveNav(this);loadPage('note');return false;">
            <i class="enchat-sidebar__nav-icon bi bi-journal-text"></i>
            <span class="enchat-sidebar__nav-text">Note</span>
          </a>
        </li>
        <li class="enchat-sidebar__nav-item">
          <a href="#" class="enchat-sidebar__nav-link" data-page="track" onclick="setActiveNav(this);loadPage('track');return false;">
            <i class="enchat-sidebar__nav-icon bi bi-graph-up"></i>
            <span class="enchat-sidebar__nav-text">Track</span>
          </a>
        </li>
        <li class="enchat-sidebar__nav-item">
          <a href="#" class="enchat-sidebar__nav-link" data-page="pomodoro" onclick="setActiveNav(this);loadPage('pomodoro');return false;">
            <i class="enchat-sidebar__nav-icon bi bi-clock-fill"></i>
            <span class="enchat-sidebar__nav-text">Pomodoro</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="enchat-sidebar__footer">
      {% include 'sidebar_auth_fragment.html' %}
    </div>
  </nav>

  <main class="enchat-main-content" id="main-content">
    {% block content %}{% endblock %}
  </main>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/enchat-sidebar.js') }}"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
<script src="{{ url_for('static', filename='js/tracking.js') }}"></script>
<script src="{{ url_for('static', filename='js/google-btn.js') }}"></script>
<script>
function setActiveNav(el) {
  document.querySelectorAll('.enchat-sidebar__nav-link').forEach(link => link.classList.remove('active'));
  el.classList.add('active');
}
window.addEventListener('DOMContentLoaded', function() {
  {% if not skip_auto_load %}
    // Check URL path first to determine which page to load
    const currentPath = window.location.pathname;
    let pageToLoad = 'dashboard';
    
    if (currentPath && currentPath !== '/' && currentPath !== '/index' && currentPath !== '/dashboard') {
      // Extract page from URL (remove leading slash)
      pageToLoad = currentPath.substring(1);
      console.log('üìç Loading page from URL:', pageToLoad);
    } else {
      {% if initial_page %}
        pageToLoad = '{{ initial_page }}';
      {% elif google_connected %}
        pageToLoad = 'class';
      {% else %}
        pageToLoad = 'dashboard';
      {% endif %}
    }
    
    // Set active nav
    const navLink = document.querySelector(`.enchat-sidebar__nav-link[data-page="${pageToLoad}"]`);
    if (navLink) {
      navLink.classList.add('active');
    }
    
    // Load the page
    loadPage(pageToLoad, false); // Don't update history on initial load
  {% endif %}
});
</script>

    <!-- Google Classroom Import Modal -->
    {% include 'modals/google_classroom_import_modal.html' %}
    
    <!-- Microsoft Teams Import Modal -->
    {% include 'modals/microsoft_teams_import_modal.html' %}

</body>
</html>