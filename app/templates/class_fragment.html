<!-- Modern Professional Class Page -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/lessons-modern.css') }}">

<style>
/* Professional Class Page Styles */
.class-page-container {
  padding: 2rem;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  min-height: 100vh;
  position: relative;
}

.class-page-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(25,118,210,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
  pointer-events: none;
}

/* Hero Section */
.class-hero {
  background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%);
  border-radius: 24px;
  padding: 3rem;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
  box-shadow: 0 20px 40px rgba(25, 118, 210, 0.2);
}

.class-hero::before {
  content: '';
  position: absolute;
  top: -30%;
  right: -30%;
  width: 160%;
  height: 160%;
  background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
  animation: float-subtle 8s ease-in-out infinite;
}

@keyframes float-subtle {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-8px) rotate(90deg); }
}

.hero-content {
  position: relative;
  z-index: 2;
}

.hero-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 2rem;
}

.hero-title-section {
  flex: 1;
}

.hero-title {
  font-size: 2.5rem;
  font-weight: 700;
  color: white;
  margin-bottom: 0.5rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.hero-subtitle {
  font-size: 1.2rem;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0;
}

.hero-actions {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.btn-hero-primary, .btn-hero-secondary {
  padding: 1rem 2rem;
  border-radius: 16px;
  font-weight: 600;
  font-size: 1rem;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(20px);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-hero-primary {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.btn-hero-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.btn-hero-primary:hover, .btn-hero-secondary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

/* Search and Filter Section */
.search-filter-section {
  display: flex;
  gap: 2rem;
  align-items: center;
  flex-wrap: wrap;
}

.search-wrapper {
  flex: 1;
  min-width: 300px;
  position: relative;
}

.search-input {
  width: 100%;
  padding: 1rem 1.5rem;
  border-radius: 16px;
  border: 2px solid rgba(255, 255, 255, 0.2);
  background: rgba(255, 255, 255, 0.1);
  color: white;
  font-size: 1rem;
  backdrop-filter: blur(20px);
  transition: all 0.3s ease;
}

.search-input::placeholder {
  color: rgba(255, 255, 255, 0.7);
}

.search-input:focus {
  outline: none;
  border-color: rgba(255, 255, 255, 0.5);
  background: rgba(255, 255, 255, 0.15);
}

.search-icon {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255, 255, 255, 0.7);
  font-size: 1.2rem;
}

.filter-pills {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.filter-pill {
  padding: 0.75rem 1.5rem;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.9rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.filter-pill:hover, .filter-pill.active {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateY(-2px);
}

/* Stats Section */
.class-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  padding: 2rem;
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px rgba(25, 118, 210, 0.1);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #1976D2, #42A5F5);
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 16px 48px rgba(25, 118, 210, 0.15);
}

.stat-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.stat-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
}

.stat-icon.total { background: linear-gradient(135deg, #1976D2, #0D47A1); }
.stat-icon.active { background: linear-gradient(135deg, #4CAF50, #388E3C); }
.stat-icon.completed { background: linear-gradient(135deg, #FF9800, #F57C00); }
.stat-icon.favorites { background: linear-gradient(135deg, #E91E63, #C2185B); }

.stat-info h3 {
  font-size: 1.1rem;
  font-weight: 600;
  color: #1A202C;
  margin-bottom: 0.25rem;
}

.stat-number {
  font-size: 2rem;
  font-weight: 700;
  color: #1976D2;
  line-height: 1;
}

/* Content Grid */
.class-content-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
}

/* Section Headers */
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.section-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: #1A202C;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.section-badge {
  background: linear-gradient(135deg, #1976D2, #42A5F5);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 600;
}

.section-subtitle {
  color: #718096;
  margin: 0;
  font-size: 0.95rem;
}

/* Lessons Section Background */
.lessons-section {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 12px 40px rgba(25, 118, 210, 0.08);
  padding: 2.5rem;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
}

.lessons-section::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(25, 118, 210, 0.03) 0%, transparent 70%);
  animation: float-subtle 12s ease-in-out infinite;
  pointer-events: none;
}

.lessons-section::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(248, 250, 252, 0.1) 100%);
  pointer-events: none;
}

/* Enhanced Section Header */
.section-header {
  position: relative;
  z-index: 2;
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 2px solid rgba(25, 118, 210, 0.1);
}

.section-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #1A202C;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.section-badge {
  background: linear-gradient(135deg, #1976D2, #42A5F5);
  color: white;
  padding: 0.4rem 1rem;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 600;
  box-shadow: 0 4px 16px rgba(25, 118, 210, 0.3);
}

.section-subtitle {
  color: #718096;
  font-size: 1.1rem;
  margin: 0;
  font-weight: 500;
}

/* Enhanced Lesson Cards */
.lessons-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 2rem;
  position: relative;
  z-index: 2;
}

.lesson-card-professional {
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 12px 40px rgba(25, 118, 210, 0.08);
  overflow: hidden;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  position: relative;
  transform: translateY(0);
}

.lesson-card-professional:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 24px 80px rgba(25, 118, 210, 0.15);
  border-color: rgba(25, 118, 210, 0.2);
}

.lesson-card-professional::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: linear-gradient(90deg, #1976D2, #42A5F5, #64B5F6);
  opacity: 0;
  transition: opacity 0.4s ease;
  z-index: 1;
}

.lesson-card-professional:hover::before {
  opacity: 1;
}

.lesson-card-professional::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(248, 250, 252, 0.1) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.lesson-card-professional:hover::after {
  opacity: 1;
}

.card-cover {
  height: 140px;
  position: relative;
  overflow: hidden;
  border-radius: 20px 20px 0 0;
}

.card-gradient-cover {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: white;
  position: relative;
  transition: transform 0.3s ease;
}

.lesson-card-professional:hover .card-gradient-cover {
  transform: scale(1.05);
}

.card-badges {
  position: absolute;
  top: 1rem;
  right: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  align-items: flex-end;
  z-index: 2;
}

.card-role-badge {
  padding: 0.4rem 1rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.card-role-badge:hover {
  transform: scale(1.05);
}

.card-role-badge.owner {
  background: linear-gradient(135deg, #FFD700, #FFA000);
  color: #000;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.card-role-badge.viewer {
  background: linear-gradient(135deg, #1976D2, #1565C0);
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.card-status-badge {
  padding: 0.4rem 1rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 700;
  background: rgba(255, 255, 255, 0.95);
  color: #1976D2;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.card-status-badge:hover {
  transform: scale(1.05);
}

.card-status-badge.completed {
  background: rgba(76, 175, 80, 0.9);
  color: white;
}

.card-status-badge.archived {
  background: rgba(158, 158, 158, 0.9);
  color: white;
}

.card-favorite {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1.1rem;
  color: #FFC107;
}

.card-favorite:hover {
  background: rgba(255, 193, 7, 0.2);
  transform: scale(1.1);
}

.card-body {
  padding: 2rem;
  position: relative;
  z-index: 2;
}

.card-title {
  font-size: 1.4rem;
  font-weight: 700;
  color: #1A202C;
  margin-bottom: 1rem;
  line-height: 1.4;
  transition: color 0.3s ease;
}

.lesson-card-professional:hover .card-title {
  color: #1976D2;
}

.card-description {
  font-size: 1rem;
  color: #718096;
  margin-bottom: 1.5rem;
  line-height: 1.6;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  transition: color 0.3s ease;
}

.lesson-card-professional:hover .card-description {
  color: #4A5568;
}

.card-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 1.5rem;
  border-top: 2px solid rgba(25, 118, 210, 0.08);
  position: relative;
  z-index: 2;
}

.card-meta {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.9rem;
  color: #A0AEC0;
  font-weight: 500;
  transition: color 0.3s ease;
}

.lesson-card-professional:hover .card-meta {
  color: #718096;
}

.card-arrow {
  color: #1976D2;
  font-size: 1.4rem;
  transition: all 0.3s ease;
  padding: 0.5rem;
  border-radius: 50%;
  background: rgba(25, 118, 210, 0.1);
}

.lesson-card-professional:hover .card-arrow {
  transform: translateX(6px) scale(1.1);
  background: rgba(25, 118, 210, 0.2);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px rgba(25, 118, 210, 0.1);
}

.empty-icon {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: linear-gradient(135deg, #1976D2, #42A5F5);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 2rem;
  font-size: 3rem;
  color: white;
}

.empty-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: #1A202C;
  margin-bottom: 0.5rem;
}

.empty-description {
  font-size: 1rem;
  color: #718096;
  margin-bottom: 2rem;
}

.btn-empty-primary {
  background: linear-gradient(135deg, #1976D2, #42A5F5);
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 16px;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-empty-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(25, 118, 210, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
  .class-page-container {
    padding: 1rem;
  }
  
  .class-hero {
    padding: 2rem;
  }
  
  .hero-header {
    flex-direction: column;
    gap: 1.5rem;
    align-items: stretch;
  }
  
  .hero-title {
    font-size: 2rem;
  }
  
  .search-filter-section {
    flex-direction: column;
    gap: 1rem;
  }
  
  .search-wrapper {
    min-width: auto;
  }
  
  .filter-pills {
    justify-content: center;
  }
  
  /* Lessons Section Mobile */
  .lessons-section {
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  .section-title {
    font-size: 1.5rem;
  }
  
  .lessons-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .lesson-card-professional {
    border-radius: 20px;
  }
  
  .card-cover {
    height: 120px;
  }
  
  .card-body {
    padding: 1.5rem;
  }
  
  .card-title {
    font-size: 1.2rem;
  }
  
  .card-description {
    font-size: 0.9rem;
  }
  
  .class-stats {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  
  .lessons-grid {
    grid-template-columns: 1fr;
  }
  
  .hero-actions {
    justify-content: center;
    flex-wrap: wrap;
  }
}

@media (max-width: 480px) {
  .hero-title {
    font-size: 1.75rem;
  }
  
  .class-stats {
    grid-template-columns: 1fr;
  }
  
  .btn-hero-primary, .btn-hero-secondary {
    padding: 0.75rem 1.5rem;
    font-size: 0.9rem;
  }
}
</style>

<div class="class-page-container">
  <!-- Hero Section -->
  <div class="class-hero">
    <div class="hero-content">
      <div class="hero-header">
        <div class="hero-title-section">
          <h1 class="hero-title">All Classes</h1>
          <p class="hero-subtitle">Organize, track, and master your learning journey</p>
        </div>
        <div class="hero-actions">
          <button class="btn-hero-primary" data-bs-toggle="modal" data-bs-target="#addLessonModal">
            <i class="bi bi-plus-circle-fill"></i>
            Create Class
          </button>
          <button class="btn-hero-secondary" onclick="window.location.reload()">
            <i class="bi bi-arrow-clockwise"></i>
            Refresh
          </button>
        </div>
      </div>
      
      <!-- Search and Filter -->
      <div class="search-filter-section">
        <div class="search-wrapper">
          <input type="text" class="search-input" id="lessonSearch" placeholder="Search classes by title or description...">
          <i class="bi bi-search search-icon"></i>
        </div>
        <div class="filter-pills">
          <button class="filter-pill active" data-filter="all" onclick="filterLessons('all', this)">
            <i class="bi bi-grid-fill"></i>
            All
          </button>
          <button class="filter-pill" data-filter="favorites" onclick="filterLessons('favorites', this)">
            <i class="bi bi-star-fill"></i>
            Favorites
          </button>
          <button class="filter-pill" data-filter="active" onclick="filterLessons('active', this)">
            <i class="bi bi-play-circle-fill"></i>
            Active
          </button>
          <button class="filter-pill" data-filter="completed" onclick="filterLessons('completed', this)">
            <i class="bi bi-check-circle-fill"></i>
            Completed
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="class-stats">
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon total">
          <i class="bi bi-book-fill"></i>
        </div>
        <div class="stat-info">
          <h3>Total Classes</h3>
          <div class="stat-number" id="total-lessons">{{ (lessons|length) + (shared_lessons|length if shared_lessons else 0) }}</div>
        </div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon active">
          <i class="bi bi-play-circle-fill"></i>
        </div>
        <div class="stat-info">
          <h3>Active Classes</h3>
          <div class="stat-number" id="active-lessons">{{ lessons|selectattr('status', 'ne', 'completed')|list|length if lessons else 0 }}</div>
        </div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon completed">
          <i class="bi bi-check-circle-fill"></i>
        </div>
        <div class="stat-info">
          <h3>Completed</h3>
          <div class="stat-number" id="completed-lessons">{{ lessons|selectattr('status', 'eq', 'completed')|list|length if lessons else 0 }}</div>
        </div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon favorites">
          <i class="bi bi-star-fill"></i>
        </div>
        <div class="stat-info">
          <h3>Favorites</h3>
          <div class="stat-number" id="favorite-lessons">{{ lessons|selectattr('is_favorite', 'eq', true)|list|length if lessons else 0 }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="class-content-grid">
    <!-- My Classes Section -->
    {% if lessons %}
    <div class="lessons-section">
      <div class="section-header">
        <div>
          <h2 class="section-title">
            <i class="bi bi-star-fill text-warning"></i>
            My Classes
            <span class="section-badge">{{ lessons|length }}</span>
          </h2>
          <p class="section-subtitle">Classes you created</p>
        </div>
      </div>
      <div class="lessons-grid" id="my-lessons-grid">
        {% for lesson in lessons %}
          <div class="lesson-card-professional" 
               data-lesson-id="{{ lesson.id }}" 
               data-status="{{ lesson.status or 'active' }}" 
               data-is-favorite="{{ 'true' if lesson.is_favorite else 'false' }}"
               onclick="navigateToClass('{{ lesson.id }}', event)">
            
            <!-- Card Cover -->
            <div class="card-cover">
              {% if lesson.cover_image %}
                <img src="{{ url_for('static', filename=lesson.cover_image) }}" 
                     alt="{{ lesson.title }}" style="width: 100%; height: 100%; object-fit: cover;">
              {% else %}
                {% set color_gradients = {
                    1: 'linear-gradient(135deg, #1976D2, #0D47A1)',
                    2: 'linear-gradient(135deg, #48BB78, #38A169)',
                    3: 'linear-gradient(135deg, #FC8181, #F56565)',
                    4: 'linear-gradient(135deg, #F6AD55, #ED8936)',
                    5: 'linear-gradient(135deg, #9F7AEA, #805AD5)',
                    6: 'linear-gradient(135deg, #F687B3, #ED64A6)'
                } %}
                {% set color_id = lesson.color_theme or lesson.selected_color or 1 %}
                {% set gradient = color_gradients[color_id|int] or color_gradients[1] %}
                <div class="card-gradient-cover" style="background: {{ gradient }};">
                  <i class="bi bi-book-fill"></i>
                </div>
              {% endif %}
              
              <!-- Badges -->
              <div class="card-badges">
                <div class="card-role-badge owner">
                  <i class="bi bi-star-fill"></i>
                  Owner
                </div>
                <div class="card-status-badge {{ lesson.status or 'active' }}">
                  {% if lesson.status == 'completed' %}
                    Completed
                  {% elif lesson.status == 'archived' %}
                    Archived
                  {% else %}
                    Active
                  {% endif %}
                </div>
                <div class="card-favorite {{ 'active' if lesson.is_favorite else '' }}" 
                     onclick="event.stopPropagation(); toggleFavorite('{{ lesson.id }}', this);">
                  <i class="bi {{ 'bi-star-fill' if lesson.is_favorite else 'bi-star' }}"></i>
                </div>
              </div>
            </div>
            
            <!-- Card Body -->
            <div class="card-body">
              <h3 class="card-title">{{ lesson.title }}</h3>
              
              {% if lesson.description %}
                <p class="card-description">{{ lesson.description }}</p>
              {% else %}
                <p class="card-description">No description available</p>
              {% endif %}
              
              <!-- Card Footer -->
              <div class="card-footer">
                <div class="card-meta">
                  <i class="bi bi-calendar3"></i>
                  <span>{{ lesson.created_at.strftime('%b %d, %Y') if lesson.created_at else 'N/A' }}</span>
                </div>
                <div class="card-arrow">
                  <i class="bi bi-arrow-right"></i>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Shared with Me Section -->
    {% if shared_lessons %}
    <div class="lessons-section">
      <div class="section-header">
        <div>
          <h2 class="section-title">
            <i class="bi bi-people-fill text-primary"></i>
            Shared with Me
            <span class="section-badge">{{ shared_lessons|length }}</span>
          </h2>
          <p class="section-subtitle">Classes shared by others</p>
        </div>
      </div>
      <div class="lessons-grid" id="shared-lessons-grid">
        {% for lesson in shared_lessons %}
          <div class="lesson-card-professional" 
               data-lesson-id="{{ lesson.id }}" 
               data-status="{{ lesson.status or 'active' }}" 
               data-is-favorite="{{ 'true' if lesson.is_favorite else 'false' }}"
               onclick="navigateToClass('{{ lesson.id }}', event)">
            
            <!-- Card Cover -->
            <div class="card-cover">
              {% if lesson.cover_image %}
                <img src="{{ url_for('static', filename=lesson.cover_image) }}" 
                     alt="{{ lesson.title }}" style="width: 100%; height: 100%; object-fit: cover;">
              {% else %}
                {% set color_gradients = {
                    1: 'linear-gradient(135deg, #1976D2, #0D47A1)',
                    2: 'linear-gradient(135deg, #48BB78, #38A169)',
                    3: 'linear-gradient(135deg, #FC8181, #F56565)',
                    4: 'linear-gradient(135deg, #F6AD55, #ED8936)',
                    5: 'linear-gradient(135deg, #9F7AEA, #805AD5)',
                    6: 'linear-gradient(135deg, #F687B3, #ED64A6)'
                } %}
                {% set color_id = lesson.color_theme or lesson.selected_color or 1 %}
                {% set gradient = color_gradients[color_id|int] or color_gradients[1] %}
                <div class="card-gradient-cover" style="background: {{ gradient }};">
                  <i class="bi bi-book-fill"></i>
                </div>
              {% endif %}
              
              <!-- Badges -->
              <div class="card-badges">
                <div class="card-role-badge viewer">
                  <i class="bi bi-eye-fill"></i>
                  Viewer
                </div>
                <div class="card-status-badge {{ lesson.status or 'active' }}">
                  {% if lesson.status == 'completed' %}
                    Completed
                  {% elif lesson.status == 'archived' %}
                    Archived
                  {% else %}
                    Active
                  {% endif %}
                </div>
              </div>
            </div>
            
            <!-- Card Body -->
            <div class="card-body">
              <h3 class="card-title">{{ lesson.title }}</h3>
              
              {% if lesson.description %}
                <p class="card-description">{{ lesson.description }}</p>
              {% else %}
                <p class="card-description">No description available</p>
              {% endif %}
              
              <!-- Card Footer -->
              <div class="card-footer">
                <div class="card-meta">
                  <i class="bi bi-person-circle"></i>
                  <span>{{ lesson.author_name or 'Shared class' }}</span>
                </div>
                <div class="card-arrow">
                  <i class="bi bi-arrow-right"></i>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Empty State -->
    {% if not lessons and not shared_lessons %}
    <div class="empty-state">
      <div class="empty-icon">
        <i class="bi bi-journal-plus"></i>
      </div>
      <h3 class="empty-title">No Classes Yet</h3>
      <p class="empty-description">Start your learning journey by creating your first class</p>
      <button class="btn-empty-primary" data-bs-toggle="modal" data-bs-target="#addLessonModal">
        <i class="bi bi-plus-circle-fill"></i>
        Create Your First Class
      </button>
    </div>
    {% endif %}
  </div>
</div>

<!-- Add Lesson Modal -->
{% include 'modals/add_lesson_modal.html' %}

<script>
// Enhanced search and filter functionality
document.addEventListener('DOMContentLoaded', function() {
    setupEnhancedSearchAndFilter();
});

function setupEnhancedSearchAndFilter() {
    const searchInput = document.getElementById('lessonSearch');
    const filterPills = document.querySelectorAll('.filter-pill');
    
    // Search functionality
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            filterLessonsBySearch(searchTerm);
        });
    }
    
    // Filter functionality
    filterPills.forEach(pill => {
        pill.addEventListener('click', function() {
            const filter = this.dataset.filter;
            filterLessons(filter, this);
        });
    });
}

function filterLessons(filter, activeButton) {
    // Update active button
    document.querySelectorAll('.filter-pill').forEach(btn => btn.classList.remove('active'));
    activeButton.classList.add('active');
    
    const allCards = document.querySelectorAll('.lesson-card-professional');
    
    allCards.forEach(card => {
        const status = card.dataset.status;
        const isFavorite = card.dataset.isFavorite === 'true';
        
        let show = true;
        
        switch(filter) {
            case 'favorites':
                show = isFavorite;
                break;
            case 'active':
                show = status === 'active' || status === 'in_progress';
                break;
            case 'completed':
                show = status === 'completed';
                break;
            case 'all':
            default:
                show = true;
                break;
        }
        
        card.style.display = show ? 'block' : 'none';
    });
}

function filterLessonsBySearch(searchTerm) {
    const allCards = document.querySelectorAll('.lesson-card-professional');
    
    allCards.forEach(card => {
        const title = card.querySelector('.card-title').textContent.toLowerCase();
        const description = card.querySelector('.card-description').textContent.toLowerCase();
        
        const matches = title.includes(searchTerm) || description.includes(searchTerm);
        card.style.display = matches ? 'block' : 'none';
    });
}

function navigateToClass(lessonId, event) {
    if (event.target.closest('.card-favorite')) {
        return; // Don't navigate if clicking favorite button
    }
    // Navigate to lesson detail
    window.location.href = `/lessons/${lessonId}`;
}

function toggleFavorite(lessonId, element) {
    // Toggle favorite functionality
    const icon = element.querySelector('i');
    const isCurrentlyFavorite = icon.classList.contains('bi-star-fill');
    
    if (isCurrentlyFavorite) {
        icon.classList.remove('bi-star-fill');
        icon.classList.add('bi-star');
        element.classList.remove('active');
    } else {
        icon.classList.remove('bi-star');
        icon.classList.add('bi-star-fill');
        element.classList.add('active');
    }
    
    // Here you would typically make an API call to update the favorite status
    // For now, we'll just update the visual state
}
</script>