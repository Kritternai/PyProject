<!-- Modern All Lessons Page - Sidebar Style -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/lessons-modern.css') }}">

<style>
/* Ripple animation for color picker */
@keyframes ripple {
    0% {
        transform: scale(0);
        opacity: 1;
    }
    100% {
        transform: scale(2);
        opacity: 0;
    }
}
</style>

<div class="lessons-page">
    <!-- Hero Header -->
    <div class="lessons-hero">
        <div class="lessons-hero-content">
            <h1 class="lessons-hero-title">All Classes</h1>
            <p class="lessons-hero-subtitle">Organize, track, and master your learning journey</p>
            
            <div class="lessons-hero-actions">
                <div class="lessons-search-wrapper">
                    <div class="lessons-search-hero">
                        <i class="bi bi-search lessons-search-hero-icon"></i>
                        <input type="text" id="lessonSearch" placeholder="Search classes by title or description...">
                        <button class="lessons-search-clear" id="clearSearch" style="display: none;" title="Clear search">
                            <i class="bi bi-x-circle-fill"></i>
                        </button>
                    </div>
                    
                    <!-- Compact Filter Pills -->
                    <div class="lessons-filter-compact">
                        <button class="filter-compact-btn active" data-filter="all" onclick="filterLessons('all', this)">
                            <i class="bi bi-grid-fill"></i>
                            <span>All</span>
                        </button>
                        <button class="filter-compact-btn" data-filter="favorites" onclick="filterLessons('favorites', this)">
                            <i class="bi bi-star-fill"></i>
                            <span>Favorites</span>
                        </button>
                        <button class="filter-compact-btn" data-filter="active" onclick="filterLessons('active', this)">
                            <i class="bi bi-play-circle-fill"></i>
                            <span>Active</span>
                        </button>
                        <button class="filter-compact-btn" data-filter="completed" onclick="filterLessons('completed', this)">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Completed</span>
                        </button>
                    </div>
                </div>
                
                <!-- Action Buttons Container -->
                <div class="lessons-action-buttons">
                    <button class="lessons-btn lessons-btn-primary" data-bs-toggle="modal" data-bs-target="#addLessonModal">
                        <i class="bi bi-plus-circle-fill"></i>
                        <span>Create Class</span>
                    </button>
                    
                    <button class="lessons-btn lessons-btn-outline" onclick="window.location.reload()">
                        <i class="bi bi-arrow-clockwise"></i>
                        <span>Refresh</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="lessons-content">

        <!-- My Classes Section -->
        {% if lessons %}
        <div class="lessons-section mb-5">
            <div class="section-header mb-3">
                <h2 class="section-title">
                    <i class="bi bi-star-fill text-warning"></i>
                    My Classes
                    <span class="badge bg-primary ms-2">{{ lessons|length }}</span>
                </h2>
                <p class="section-subtitle text-muted">Classes you created</p>
            </div>
            <div class="lessons-grid" id="my-lessons-grid">
                {% for lesson in lessons %}
                    <div class="lesson-card-modern" 
                         data-lesson-id="{{ lesson.id }}" 
                         data-status="{{ lesson.status or 'active' }}" 
                         data-is-favorite="{{ 'true' if lesson.is_favorite else 'false' }}"
                         onclick="navigateToClass('{{ lesson.id }}', event)"
                         style="cursor: pointer;">
                        
                        <!-- Card Cover -->
                        <div class="lesson-card-cover">
                            {% if lesson.cover_image %}
                                <img src="{{ url_for('static', filename=lesson.cover_image) }}" 
                                     alt="{{ lesson.title }}">
                            {% else %}
                                {% set color_gradients = {
                                    1: 'linear-gradient(135deg, #1976D2, #0D47A1)',
                                    2: 'linear-gradient(135deg, #48BB78, #38A169)',
                                    3: 'linear-gradient(135deg, #FC8181, #F56565)',
                                    4: 'linear-gradient(135deg, #F6AD55, #ED8936)',
                                    5: 'linear-gradient(135deg, #9F7AEA, #805AD5)',
                                    6: 'linear-gradient(135deg, #F687B3, #ED64A6)'
                                } %}
                                {% set color_id = lesson.color_theme or lesson.selected_color or 1 %}
                                {% set gradient = color_gradients[color_id|int] or color_gradients[1] %}
                                <div class="lesson-card-gradient-cover" style="background: {{ gradient }};">
                                    <i class="bi bi-book-fill"></i>
                                </div>
                            {% endif %}
                            
                            <!-- Badges -->
                            <div class="lesson-card-badges">
                                <!-- Role Badge -->
                                <div class="lesson-card-role-badge owner">
                                    <i class="bi bi-star-fill"></i>
                                    Owner
                                </div>
                                
                                <div class="lesson-card-status-badge {{ lesson.status or 'active' }}">
                                    {% if lesson.status == 'completed' %}
                                        Completed
                                    {% elif lesson.status == 'archived' %}
                                        Archived
                                    {% else %}
                                        Active
                                    {% endif %}
                                </div>
                                
                                <div class="lesson-card-favorite {{ 'active' if lesson.is_favorite else '' }}" 
                                     onclick="event.stopPropagation(); toggleFavorite('{{ lesson.id }}', this);">
                                    <i class="bi {{ 'bi-star-fill' if lesson.is_favorite else 'bi-star' }}"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Card Body -->
                        <div class="lesson-card-body">
                            <h3 class="lesson-card-title">{{ lesson.title }}</h3>
                            
                            {% if lesson.description %}
                                <p class="lesson-card-description">{{ lesson.description }}</p>
                            {% else %}
                                <p class="lesson-card-description">No description available</p>
                            {% endif %}
                            
                            <!-- Card Footer -->
                            <div class="lesson-card-footer">
                                <div class="lesson-card-meta">
                                    <i class="bi bi-calendar3"></i>
                                    <span>{{ lesson.created_at.strftime('%b %d, %Y') if lesson.created_at else 'N/A' }}</span>
                                </div>
                                <div class="lesson-card-arrow">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Shared with Me Section -->
        {% if shared_lessons %}
        <div class="lessons-section">
            <div class="section-header mb-3">
                <h2 class="section-title">
                    <i class="bi bi-people-fill text-primary"></i>
                    Shared with Me
                    <span class="badge bg-info ms-2">{{ shared_lessons|length }}</span>
                </h2>
                <p class="section-subtitle text-muted">Classes shared by others</p>
            </div>
            <div class="lessons-grid" id="shared-lessons-grid">
                {% for lesson in shared_lessons %}
                    <div class="lesson-card-modern" 
                         data-lesson-id="{{ lesson.id }}" 
                         data-status="{{ lesson.status or 'active' }}" 
                         data-is-favorite="{{ 'true' if lesson.is_favorite else 'false' }}"
                         onclick="navigateToClass('{{ lesson.id }}', event)"
                         style="cursor: pointer;">
                        
                        <!-- Card Cover -->
                        <div class="lesson-card-cover">
                            {% if lesson.cover_image %}
                                <img src="{{ url_for('static', filename=lesson.cover_image) }}" 
                                     alt="{{ lesson.title }}">
                            {% else %}
                                {% set color_gradients = {
                                    1: 'linear-gradient(135deg, #1976D2, #0D47A1)',
                                    2: 'linear-gradient(135deg, #48BB78, #38A169)',
                                    3: 'linear-gradient(135deg, #FC8181, #F56565)',
                                    4: 'linear-gradient(135deg, #F6AD55, #ED8936)',
                                    5: 'linear-gradient(135deg, #9F7AEA, #805AD5)',
                                    6: 'linear-gradient(135deg, #F687B3, #ED64A6)'
                                } %}
                                {% set color_id = lesson.color_theme or lesson.selected_color or 1 %}
                                {% set gradient = color_gradients[color_id|int] or color_gradients[1] %}
                                <div class="lesson-card-gradient-cover" style="background: {{ gradient }};">
                                    <i class="bi bi-book-fill"></i>
                                </div>
                            {% endif %}
                            
                            <!-- Badges -->
                            <div class="lesson-card-badges">
                                <!-- Role Badge -->
                                <div class="lesson-card-role-badge viewer">
                                    <i class="bi bi-eye-fill"></i>
                                    Viewer
                                </div>
                                
                                <div class="lesson-card-status-badge {{ lesson.status or 'active' }}">
                                    {% if lesson.status == 'completed' %}
                                        Completed
                                    {% elif lesson.status == 'archived' %}
                                        Archived
                                    {% else %}
                                        Active
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Card Body -->
                        <div class="lesson-card-body">
                            <h3 class="lesson-card-title">{{ lesson.title }}</h3>
                            
                            {% if lesson.description %}
                                <p class="lesson-card-description">{{ lesson.description }}</p>
                            {% else %}
                                <p class="lesson-card-description">No description available</p>
                            {% endif %}
                            
                            <!-- Card Footer -->
                            <div class="lesson-card-footer">
                                <div class="lesson-card-meta">
                                    <i class="bi bi-person-circle"></i>
                                    <span>{{ lesson.author_name or 'Shared class' }}</span>
                                </div>
                                <div class="lesson-card-arrow">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Empty State (only if both are empty) -->
        {% if not lessons and not shared_lessons %}
        <div class="lessons-grid">
            <div class="lessons-empty">
                <div class="lessons-empty-icon">
                    <i class="bi bi-journal-plus"></i>
                </div>
                <h3>No Classes Yet</h3>
                <p>Start your learning journey by creating your first class</p>
                <button class="lessons-btn lessons-btn-primary" data-bs-toggle="modal" data-bs-target="#addLessonModal">
                    <i class="bi bi-plus-circle-fill"></i>
                    <span>Create Your First Class</span>
                </button>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Real-time search is handled by main.js via setupLessonSearchAndFilter() -->

<!-- Add Lesson Modal -->
{% include 'modals/add_lesson_modal.html' %}


